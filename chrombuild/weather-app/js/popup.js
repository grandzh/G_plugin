var citysIsShowGroup;if(typeof sogouExplorer!="undefined"){chrome=sogouExplorer}function init(){if(localStorage['showInTab']=='1'&&!window.location.search){openInNewTab()}chrome.extension.getBackgroundPage().checkAndWelcome(false);loadHtml(true);if(window.location.search){document.body.className="newTabBody"}$('#aRefresh').unbind("click").bind("click",function(e){chrome.extension.getBackgroundPage().loadWeather();if(typeof sogouExplorer!="undefined"){setTimeout(function(){loadHtml()},1000)}else{loadHtml()}return false});$('#btnNewTab').unbind("click").bind("click",function(e){openInNewTab()});$('#btnClose').unbind("click").bind("click",function(e){window.close()});var bwidth=$("body").width();if(localStorage['dayCount']<5){$("#wannian").css("left",Math.floor((bwidth-450)/2));$("#wannian").css("float","left");$("#ycpm").css("width","436px");$("#ycpm").css("height","auto");$("#pmw").css("left",Math.floor((bwidth-439)/2));$("#pmw").css("float","left");$("#pmw").css("margin-left","0px")}resetSogou()}function openInNewTab(){var url=window.location.href;url=url.replace(/#$/gi,"");chrome.tabs.create({url:url+"?temp",selected:true});window.close()}function toggleLunar(){var lunar=document.getElementById("iframeLunar");if(lunar.style.display){document.getElementById("separatorHr").style.display="";document.getElementById('linkLunar').innerText='︽万年历';$("#ycpm").show();lunar.src="wannianli.html";lunar.style.display=""}else{document.getElementById("separatorHr").style.display="none";document.getElementById('linkLunar').innerText='︾万年历';$("#ycpm").hide();lunar.style.display="none"}return false}function loadHtml(firstTime){var count=parseInt(localStorage["dayCount"]||"5");count=Math.max(count,2.6);var bodyWidth=800-(5-count)*139;document.body.style.width=bodyWidth+"px";$('#iframeLunar').height(300);document.getElementById('showDiv').innerHTML=chrome.extension.getBackgroundPage().getInnerHTML();if(window.location.search){$('#btnNewTab').hide();$('#btnClose').hide()}if(firstTime&&localStorage['showLunar']=="1"){toggleLunar()}$('#linkLunar').unbind("click").bind("click",function(e){return toggleLunar()});$('#btnNewTab').unbind("click").bind("click",function(e){openInNewTab()});$('#btnClose').unbind("click").bind("click",function(e){window.close()});$('#aSetting').unbind("click").bind("click",function(e){openURL('options.html');if(typeof sogouExplorer!="undefined"){setTimeout(function(){window.close()},200)}});$('#aRefresh').unbind("click").bind("click",function(e){chrome.extension.getBackgroundPage().loadWeather();if(typeof sogouExplorer!="undefined"){setTimeout(function(){loadHtml()},1000)}else{loadHtml()}return false});loadAirAPI();var bwidth=$("body").width();if(localStorage['dayCount']<5){$("#wannian").css("left",Math.floor((bwidth-450)/2));$("#wannian").css("float","left");$("#ycpm").css("width","436px");$("#ycpm").css("height","auto");$("#pmw").css("left",Math.floor((bwidth-439)/2));$("#pmw").css("float","left");$("#pmw").css("margin-left","0px")}resetSogou()}function getIsShowCity(index){if(index>citysIsShowGroup.length-1){return false}return citysIsShowGroup.charAt(index)=="1"}function setIsShowCity(index,isShow){if(index>citysIsShowGroup.length-1){for(var i=citysIsShowGroup.length;i<=index;i++){citysIsShowGroup+="0"}}citysIsShowGroup=citysIsShowGroup.substr(0,index)+(isShow?"1":"0")+citysIsShowGroup.substr(index+1);localStorage["citysIsShowGroup"]=citysIsShowGroup}function groupExpand(ele,notAnimate){var container=$(ele).parents("div[_cityid]");var cityid=container.attr("_cityid").substr(3,4);if(container.attr("_cityid").substr(7,2)=="00")cityid=cityid.substr(0,2)+"01";var index=chrome.extension.getBackgroundPage().groupIndexs[cityid];if(!index)chrome.extension.getBackgroundPage().groupIndexs[cityid]=(index=0)+1;var url="http://hainang1234.w37.en.tm/getGroupInfo.aspx?cityid="+cityid+"&index=0";container.find("iframe").attr("src",url);container.find(".groupIframeDiv").show();container.find(".btnGroupExpand").hide();container.find(".btnGroupCollapse").show();if(!notAnimate)container.animate({height:"160px"},300);else container.height(160);var index=parseInt(container.attr("_index"));setIsShowCity(index,true)}function groupCollapse(ele){var container=$(ele).parents("div[_cityid]");container.find(".groupIframeDiv").hide();container.find(".btnGroupCollapse").hide();container.find(".btnGroupExpand").show();container.find("iframe").attr("src","");container.animate({height:"100px"},300);var index=parseInt(container.attr("_index"));setIsShowCity(index,false)}document.addEventListener('DOMContentLoaded',init);var extensionActHandle=function(ops){var act=ops.act;var cityID=ops.cityID;if(act=="refresh"){loadHtml()}};if(typeof chrome.extension.onMessage=='object'){chrome.extension.onMessage.addListener(extensionActHandle)}else{chrome.extension.onRequest.addListener(extensionActHandle)}function resetSogou(){if(typeof sogouExplorer!="undefined"){var lunar=document.getElementById("iframeLunar");document.getElementById("separatorHr").style.display="";document.getElementById("linkLunar").style.display="none";lunar.src="wannianli.html";lunar.style.display="";document.getElementById("btnNewTab").style.display="none"}}